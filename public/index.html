<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Sistema de gestión de órdenes de reparación - Enlaces Comunicaciones">
  <meta name="keywords" content="reparaciones, gestión, órdenes, Enlaces Comunicaciones">
  <meta name="author" content="Enlaces Comunicaciones">
  
  <title>Sistema de Reparaciones - Enlaces Comunicaciones</title>
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" href="/icons/web-app-manifest-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">
  <link rel="shortcut icon" href="/icons/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#004080">
  
  <!-- Estilos -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Header Principal -->
  <header class="container-fluid bg-light border-bottom py-3 mb-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8 d-flex align-items-center">
          <img src="img/logo_enlaces.png" 
               alt="Enlaces Comunicaciones - Logo" 
               height="80" 
               class="me-3">
          <div>
            <h1 class="h4 mb-0 text-primary">Sistema de Reparaciones</h1>
            <small class="text-muted">Enlaces Comunicaciones</small>
          </div>
        </div>
        <div class="col-md-4 text-end">
          <div class="d-flex align-items-center justify-content-end">
            <span class="me-3 text-muted small" id="userInfo"></span>
            <button type="button" 
                    class="btn btn-outline-danger btn-sm" 
                    onclick="cerrarSesion()"
                    title="Cerrar sesión">
              <i class="bi bi-box-arrow-right"></i>
              <span class="d-none d-md-inline ms-1">Cerrar Sesión</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido Principal -->
  <main class="container">
    <!-- Alertas -->
    <div id="alertContainer" class="mb-4"></div>
    
    <!-- Formulario de Nueva Orden -->
    <section class="card mb-5">
      <div class="card-header bg-primary text-white">
        <h2 class="h5 mb-0">
          <i class="bi bi-plus-circle me-2"></i>
          Nueva Orden de Reparación
        </h2>
      </div>
      <div class="card-body">
        <form id="pedidoForm" class="row g-3" novalidate>
          <div class="col-md-6">
            <label for="cliente" class="form-label">Cliente <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="cliente"
                   name="cliente" 
                   placeholder="Nombre del cliente" 
                   required>
            <div class="invalid-feedback">
              Por favor ingresa el nombre del cliente.
            </div>
          </div>
          
          <div class="col-md-6">
            <label for="equipo" class="form-label">Equipo <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="equipo"
                   name="equipo" 
                   placeholder="Tipo de equipo a reparar" 
                   required>
            <div class="invalid-feedback">
              Por favor ingresa el tipo de equipo.
            </div>
          </div>
          
          <div class="col-md-6">
            <label for="telefono" class="form-label">Teléfono</label>
            <input type="tel" 
                   class="form-control" 
                   id="telefono"
                   name="telefono" 
                   placeholder="Número de teléfono">
          </div>
          
          <div class="col-md-6">
            <label for="mail" class="form-label">Email</label>
            <input type="email" 
                   class="form-control" 
                   id="mail"
                   name="mail" 
                   placeholder="correo@ejemplo.com">
          </div>
          
          <div class="col-md-6">
            <label for="accesorios" class="form-label">Accesorios</label>
            <input type="text" 
                   class="form-control" 
                   id="accesorios"
                   name="accesorios" 
                   placeholder="Cable, cargador, funda, etc.">
          </div>
          
          <div class="col-12">
            <label for="descripcion_falla" class="form-label">Descripción de la Falla</label>
            <textarea class="form-control" 
                      id="descripcion_falla"
                      name="descripcion_falla" 
                      rows="3" 
                      placeholder="Describe el problema del equipo..."></textarea>
          </div>
          
          <div class="col-12">
            <button type="submit" class="btn btn-primary">
              <i class="bi bi-plus-lg me-2"></i>
              Crear Orden
            </button>
            <button type="reset" class="btn btn-outline-secondary ms-2">
              <i class="bi bi-arrow-clockwise me-2"></i>
              Limpiar
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Listado de Órdenes -->
    <section class="card">
      <div class="card-header bg-secondary text-white">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h2 class="h5 mb-0">
              <i class="bi bi-list-ul me-2"></i>
              Órdenes de Reparación
            </h2>
          </div>
          <div class="col-md-6">
            <div class="row g-2">
              <div class="col-8">
                <input type="search" 
                       class="form-control form-control-sm" 
                       id="search"
                       placeholder="Buscar por cliente, equipo, teléfono..."
                       aria-label="Buscar órdenes">
              </div>
              <div class="col-4">
                <button type="button" 
                        class="btn btn-success btn-sm w-100" 
                        onclick="exportarExcel()"
                        title="Exportar a Excel">
                  <i class="bi bi-file-earmark-excel"></i>
                  <span class="d-none d-md-inline ms-1">Excel</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0" id="pedidos">
            <thead class="table-dark">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Cliente</th>
                <th scope="col">Equipo</th>
                <th scope="col">Teléfono</th>
                <th scope="col">Email</th>
                <th scope="col">Estado</th>
                <th scope="col">Costo</th>
                <th scope="col">Nota Técnica</th>
                <th scope="col" class="text-center">Acciones</th>
                <th scope="col">F. Ingreso</th>
                <th scope="col">F. Reparado</th>
                <th scope="col">F. Retiro</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="12" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <p class="mt-2 mb-0 text-muted">Cargando órdenes...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="container mt-5 pt-4 border-top">
    <div class="row">
      <div class="col-md-6">
        <p class="text-muted small mb-0">
          © 2025 Enlaces Comunicaciones. Todos los derechos reservados.
        </p>
      </div>
      <div class="col-md-6 text-md-end">
        <p class="text-muted small mb-0">
          Sistema de Gestión de Reparaciones v2.0.0
        </p>
      </div>
    </div>
  </footer>

  <!-- Modal para Marcar como Reparado -->
  <div class="modal fade" id="modalReparado" tabindex="-1" aria-labelledby="modalReparadoLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="modalReparadoLabel">
            <i class="bi bi-check-circle-fill me-2"></i>Completar Reparación
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-success" role="alert">
            <i class="bi bi-info-circle me-2"></i>
            Complete los siguientes datos para finalizar la reparación
          </div>
          
          <form id="formReparado">
            <input type="hidden" id="pedidoIdReparado">
            
            <div class="mb-3">
              <label for="costoFinal" class="form-label">
                <i class="bi bi-currency-dollar me-1"></i>Costo Final ($)
              </label>
              <input type="number" 
                     class="form-control" 
                     id="costoFinal"
                     name="costo_estimado" 
                     placeholder="0.00" 
                     step="0.01" 
                     min="0"
                     required>
            </div>
            
            <div class="mb-3">
              <label for="notaTecnica" class="form-label">
                <i class="bi bi-journal-text me-1"></i>Nota Técnica
              </label>
              <textarea class="form-control" 
                        id="notaTecnica"
                        name="nota_tecnica" 
                        rows="4" 
                        placeholder="Describe el trabajo realizado, repuestos utilizados, observaciones..."
                        required></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-lg me-1"></i>Cancelar
          </button>
          <button type="button" class="btn btn-success" onclick="confirmarReparado()">
            <i class="bi bi-check-circle-fill me-1"></i>Completar Reparación
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Marcar como Retirado -->
  <div class="modal fade" id="modalRetirado" tabindex="-1" aria-labelledby="modalRetiradoLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title" id="modalRetiradoLabel">
            <i class="bi bi-box-arrow-up me-2"></i>Marcar como Retirado
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info" role="alert">
            <i class="bi bi-info-circle me-2"></i>
            Registra quién retiró el equipo
          </div>
          
          <form id="formRetirado">
            <input type="hidden" id="pedidoIdRetirado">
            
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="esMismoDueno" onchange="toggleRetiroPor()">
                <label class="form-check-label" for="esMismoDueno">
                  <i class="bi bi-person-check me-1"></i>Lo retiró el mismo dueño
                </label>
              </div>
            </div>
            
            <div class="mb-3" id="campoRetiroPor">
              <label for="retiradoPor" class="form-label">
                <i class="bi bi-person me-1"></i>Nombre de quien retira
              </label>
              <input type="text" 
                     class="form-control" 
                     id="retiradoPor"
                     name="retirado_por" 
                     placeholder="Nombre completo de la persona que retira el equipo"
                     required>
              <div class="form-text">
                Si no es el dueño, indique nombre y parentesco/relación
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-lg me-1"></i>Cancelar
          </button>
          <button type="button" class="btn btn-info" onclick="confirmarRetirado()">
            <i class="bi bi-box-arrow-up me-1"></i>Confirmar Retiro
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM4tIRAI062MaV8sfjQKYVGjOBaZBOA87z+IhZE9DA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="script.js"></script>
</body>
</html>
